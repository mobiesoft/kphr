---
import { X, Menu } from '@lucide/astro';
import { Image } from 'astro:assets';
import Button from '@/components/ui/Button.astro';
import mainLogo from '@/images/main-logo.png';

const currentPath = Astro.url.pathname.replace(/\/$/, '') || '/';
const isActive = (path: string) =>
  currentPath === path || currentPath.startsWith(`${path}/`);

// Shared navigation items
const navItems = [
  { label: 'Home', href: '/' },
  { label: 'About', href: '/about' },
  { label: 'Articles', href: '/articles' },
  { label: 'Virtual Staff', href: '/virtual-assistants' },
];

const ctaItem = { label: 'Contact Us', href: '/contact' };
---

<nav class="bg-background border-border w-full border-b px-6 py-4">
  <div class="mx-auto flex max-w-7xl items-center justify-between">
    <a href="/" class="flex items-center">
      <Image src={mainLogo} alt="KPHR Logo" width={200} class="h-10 w-auto" />
    </a>

    <!-- Mobile hamburger -->
    <div class="md:hidden">
      <button
        id="menu-button"
        class="text-foreground hover:text-primary focus:ring-primary inline-flex items-center justify-center rounded-md p-2 focus:ring-2 focus:outline-none"
        aria-label="Toggle navigation"
        aria-controls="mobile-nav"
        aria-expanded="false"
      >
        <Menu data-open-icon class="h-6 w-6" />
        <X data-close-icon class="data-close-icon hidden h-6 w-6" />
      </button>
    </div>

    <div class="hidden items-center space-x-8 md:flex">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class={`text-foreground hover:text-primary transition-colors ${isActive(item.href) ? 'text-primary font-semibold' : ''}`}
          >
            {item.label}
          </a>
        ))
      }
      <Button
        href={ctaItem.href}
        class="bg-gradient-primary text-primary-foreground shadow-button hover:opacity-90"
      >
        {ctaItem.label}
      </Button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-nav" class="hidden md:hidden">
    <div
      class="border-border bg-card/60 mt-4 space-y-1 rounded-xl border p-2 shadow-lg backdrop-blur-sm"
    >
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class={`text-foreground hover:text-primary hover:bg-muted/40 focus:ring-primary block rounded-md px-3 py-2 transition-colors focus:ring-2 focus:outline-none ${isActive(item.href) ? 'text-primary font-semibold' : ''}`}
          >
            {item.label}
          </a>
        ))
      }
      <div class="border-border mt-2 border-t pt-3">
        <Button
          href={ctaItem.href}
          class="bg-gradient-primary text-primary-foreground shadow-button w-full hover:opacity-90"
        >
          {ctaItem.label}
        </Button>
      </div>
    </div>
  </div>
</nav>

<script>
  const btn = document.getElementById('menu-button');
  const menu = document.getElementById('mobile-nav');
  const openIcon = btn?.querySelector('[data-open-icon]');
  const closeIcon = btn?.querySelector('[data-close-icon]');

  if (btn && menu) {
    btn.addEventListener('click', () => {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', (!expanded).toString());
      menu.classList.toggle('hidden', expanded);
      openIcon?.classList.toggle('hidden', !expanded);
      closeIcon?.classList.toggle('hidden', expanded);
    });

    // Close the menu when a link is clicked
    menu.querySelectorAll('a').forEach((a) => {
      a.addEventListener('click', () => {
        btn.setAttribute('aria-expanded', 'false');
        menu.classList.add('hidden');
        openIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
      });
    });

    // Close on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true') {
        btn.click();
      }
    });
  }
</script>

---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

import Button from '@/components/ui/Button.astro';
import Card from '@/components/ui/Card.astro';
import CardContent from '@/components/ui/CardContent.astro';

const latestBlogs: CollectionEntry<'blogs'>[] = (await getCollection('blogs'))
  .sort(
    (a: CollectionEntry<'blogs'>, b: CollectionEntry<'blogs'>) =>
      b.data.date.valueOf() - a.data.date.valueOf()
  )
  .slice(0, 3);

const formatDate = (d: Date) =>
  d.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
---

<section class="bg-muted/30 w-full px-6 py-16">
  <div class="mx-auto max-w-6xl">
    <div class="mb-12 text-center">
      <h2 class="text-foreground mb-4 text-3xl font-bold md:text-5xl">
        HR Matters Blog
      </h2>
      <p class="text-muted-foreground mx-auto max-w-3xl text-xl">
        Real stories from an employer's perspective. Practical insights on what
        to do (and what to avoid) in HR management, shared to help SMBs navigate
        common challenges.
      </p>
    </div>

    <div class="mb-12 grid gap-8 md:grid-cols-3">
      {
        latestBlogs.map((entry) => (
          <Card class="shadow-card space-y-4 overflow-hidden border-0">
            {entry.data.image ? (
              <Image
                src={entry.data.image}
                alt={entry.data.title}
                class="h-48 w-full object-cover"
              />
            ) : (
              <div class="bg-muted h-48" />
            )}
            <CardContent class="p-6">
              <h3 class="text-foreground mb-3 text-xl leading-tight font-semibold">
                {entry.data.title}
              </h3>
              <div class="text-muted-foreground mb-3 text-sm">
                {formatDate(entry.data.date)} â€¢ {entry.data.author}
              </div>
              <p class="text-muted-foreground">{entry.data.excerpt}</p>
            </CardContent>
          </Card>
        ))
      }
    </div>

    <div class="text-center">
      <Button
        variant="default"
        size="lg"
        class="bg-gradient-primary text-primary-foreground shadow-button"
      >
        View All Posts
      </Button>
    </div>
  </div>
</section>

---
import { Image, getImage } from 'astro:assets';
import MainLayout from '@/layouts/MainLayout.astro';
import Prose from '@/components/typography/Prose.astro';
import Badge from '@/components/ui/Badge.astro';
import { SITE, ISPARTOF } from '@/data/constants';

interface Props {
  data: any;
  collection: string;
  entry: any;
  body: string | undefined;
}

const { data, collection, entry } = Astro.props as Props;
const title: string = `${data.title} | ${SITE.title}`;
const description: string = data.description;

// Generate dynamic OG image path
const ogImagePath = `/og/${collection}/${entry.id}.png`;
---

<MainLayout
  title={title}
  structuredData={{
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    '@id': `https://www.kphr.com/${collection}/${entry.id}`,
    url: `https://www.kphr.com/${collection}/${entry.id}`,
    name: title,
    description: description,
    isPartOf: ISPARTOF,
    inLanguage: 'en-US',
  }}
  meta={description}
  ogData={{
    title: `${data.title} | ${SITE.title}`,
    description: description,
    image: ogImagePath,
  }}
>
  <section class="mx-auto max-w-5xl px-6 py-16">
    <h1
      class="text-foreground font-headfont mb-2 text-center text-3xl font-bold md:text-5xl"
    >
      {data.title}
    </h1>

    <p class="text-muted-foreground mb-6 text-center text-sm">
      {data.provider}
      {data.category ? <>&nbsp; • &nbsp;{data.category}</> : ''}
      {data.priceRange ? <>&nbsp; • &nbsp;{data.priceRange}</> : ''}
      {
        typeof data.rating === 'number' ? (
          <>&nbsp; • &nbsp;Rating: {data.rating}/5</>
        ) : (
          ''
        )
      }
    </p>

    {
      Array.isArray(data.tags) && data.tags.length > 0 ? (
        <div class="mb-8 flex flex-wrap justify-center gap-2">
          {data.tags.map((tag: string) => (
            <Badge>{tag}</Badge>
          ))}
        </div>
      ) : (
        ''
      )
    }

    <div class="mx-auto flex max-w-prose flex-col gap-5">
      <figure
        class="shadow-card border-border mx-auto overflow-hidden rounded-xl border"
      >
        <Image
          width={700}
          height={600}
          src={data.image}
          alt={`Cover image for ${data.title}`}
          class="h-auto w-full object-cover"
        />
      </figure>
      <Prose>
        <slot />
      </Prose>
    </div>
  </section>
</MainLayout>

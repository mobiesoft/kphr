---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import { ISPARTOF } from '@/data/constants';

import MainLayout from '@/layouts/MainLayout.astro';
import Card from '@/components/ui/Card.astro';
import CardContent from '@/components/ui/CardContent.astro';

const articles: CollectionEntry<'articles'>[] = (
  await getCollection('articles')
).sort(
  (a: CollectionEntry<'articles'>, b: CollectionEntry<'articles'>) =>
    b.data.date.valueOf() - a.data.date.valueOf()
);

const formatDate = (d: Date) =>
  d.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });

const title = 'KPHR | Articles';
const description =
  'Explore KPHR articles for practical HR insights, tips, and strategies tailored for small businesses.';
---

<MainLayout
  title={title}
  structuredData={{
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    '@id': 'https://kphr.com/contact',
    url: 'https://kphr.com/contact',
    name: title,
    description: description,
    isPartOf: ISPARTOF,
    inLanguage: 'en-US',
  }}
  meta={description}
>
  <section class="bg-muted/30 w-full px-6 py-16">
    <div class="mx-auto max-w-6xl">
      <div class="mb-12 text-center">
        <h1 class="text-foreground mb-4 text-3xl font-bold md:text-5xl">
          All Articles
        </h1>
        <p class="text-muted-foreground mx-auto max-w-3xl text-xl">
          Real stories from an employer's perspective. Practical insights to
          help SMBs navigate common HR challenges.
        </p>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {
          articles.map((entry) => (
            <Card
              href={`/articles/${entry.id}`}
              class="shadow-card space-y-4 overflow-hidden border-0"
            >
              {entry.data.image ? (
                <Image
                  src={entry.data.image}
                  alt={entry.data.title}
                  class="h-48 w-full object-cover"
                />
              ) : (
                <div class="bg-muted h-48" />
              )}
              <CardContent class="p-6">
                <h3 class="text-foreground mb-3 text-xl leading-tight font-semibold">
                  {entry.data.title}
                </h3>
                <div class="text-muted-foreground mb-3 text-sm">
                  {formatDate(entry.data.date)} â€¢ {entry.data.author}
                </div>
                <p class="text-muted-foreground">{entry.data.excerpt}</p>
              </CardContent>
            </Card>
          ))
        }
      </div>
    </div>
  </section>
</MainLayout>
